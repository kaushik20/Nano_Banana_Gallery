<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            background-image: radial-gradient(at 50% 50%, rgba(26, 41, 59, 0.8), rgba(13, 17, 23, 1));
            color: #c9d1d9;
        }
        .container {
            border: 1px solid #30363d;
        }
        .gallery-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid #30363d;
            background-color: #161b22;
        }
        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }
        .gallery-card img {
            transition: transform 0.3s ease;
        }
        .gallery-card:hover img {
            transform: scale(1.05);
        }
        .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: translateY(-50px);
            opacity: 0;
        }
        .modal-show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 sm:p-8">

    <div id="app" class="container bg-gray-900 rounded-2xl shadow-2xl p-6 w-full max-w-6xl space-y-8 md:p-10">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center text-white leading-tight">The Nano Banana Gallery</h1>

        <div>
            <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                </div>
        </div>

        <div id="detailModal" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden items-center justify-center p-4 z-50">
            <div class="modal-content bg-gray-800 rounded-xl p-6 shadow-2xl w-full max-w-3xl border border-gray-700">
                <div class="flex justify-end">
                    <button id="closeModalBtn" class="text-gray-400 hover:text-white text-3xl font-light">&times;</button>
                </div>
                <div class="text-center space-y-6">
                    <img id="modalImage" src="" alt="Detail Image" class="w-full h-auto rounded-lg shadow-lg max-h-[60vh] object-contain border-4 border-gray-700">
                    <p id="modalPrompt" class="text-lg text-gray-200 font-medium p-3 bg-gray-700 rounded-md"></p>
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                        <button id="rewritePromptBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 flex items-center gap-2">
                            <span id="rewriteText">Rewrite Prompt âœ¨</span>
                            <div id="rewriteLoader" class="hidden loading-spinner"></div>
                        </button>
                        <button id="listenPromptBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 flex items-center gap-2">
                            <span id="listenText">Listen to Prompt ðŸŽ§</span>
                            <div id="listenLoader" class="hidden loading-spinner"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="messageBox" class="fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-2xl transition-all duration-300 transform translate-y-20 opacity-0 z-50">
            <p id="messageText" class="text-white font-medium"></p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const galleryDiv = document.getElementById('gallery');
            const detailModal = document.getElementById('detailModal');
            const modalImage = document.getElementById('modalImage');
            const modalPrompt = document.getElementById('modalPrompt');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const rewritePromptBtn = document.getElementById('rewritePromptBtn');
            const listenPromptBtn = document.getElementById('listenPromptBtn');
            const rewriteText = document.getElementById('rewriteText');
            const rewriteLoader = document.getElementById('rewriteLoader');
            const listenText = document.getElementById('listenText');
            const listenLoader = document.getElementById('listenLoader');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');

            const galleryItems = [
                { id: '1', url: 'WEBP file/1757708247652.webp', prompt: 'A person standing on a giant smartphone, surrounded by glowing neon light trails.' },
                { id: '2', url: 'WEBP file/1757708917654.webp', prompt: 'A realistic action figure on a desk next to a computer displaying a 3D wireframe model.' },
                { id: '3', url: 'WEBP file/1757709208322.webp', prompt: 'A person posing with a miniature model car, with a larger 3D model shown on a computer screen.' },
                { id: '4', url: 'WEBP file/1757709665136.webp', prompt: 'A cinematic portrait of a man in a blue t-shirt, looking away from the camera with a soft shadow.' },
                { id: '5', url: 'WEBP file/1757709822282.webp', prompt: 'A portrait of a man in a maroon t-shirt with a strong side light creating a prominent shadow.' },
                { id: '6', url: 'WEBP file/1757709830059.webp', prompt: 'A warm-toned portrait of a man in a green t-shirt, looking to the side with a prominent shadow on a cream wall.' },
                { id: '7', url: 'WEBP file/1757711377060.webp', prompt: 'A person with orange headphones standing on a large smartphone, in a futuristic setting.' },
                { id: '8', url: 'WEBP file/1757713384637.webp', prompt: 'An action figure in a professional suit inside a collector\'s box labeled "The Virtuoso."' },
                { id: '9', url: 'WEBP file/1757714399151.webp', prompt: 'A professional headshot of a man in a black suit against a dark background.' },
                { id: '10', url: 'WEBP file/1757735207482.webp', prompt: 'A man in a suit standing in the rain at night with city lights blurred in the background.' },
                { id: '11', url: 'WEBP file/1757737668356.webp', prompt: 'A man sitting on a giant Instagram logo, a futuristic monitor in the background showing a social media page.' },
                { id: '12', url: 'WEBP file/1757738146684.webp', prompt: 'A male cricket player swinging a bat, captured in a stadium under daylight.' },
                { id: '13', url: 'WEBP file/1757739761521.webp', prompt: 'A studio portrait of a man in a black suit, with social media icons overlaid and dramatic lighting.' },
                { id: '14', url: 'WEBP file/1757744597437.webp', prompt: 'A cartoonish illustration of a man with a mustache, wearing a suit and a white shirt.' },
                { id: '15', url: 'WEBP file/1757745218321.webp', prompt: 'A beautiful woman in a purple saree with traditional jewelry, standing gracefully in a sunlit room.' },
                { id: '16', url: 'WEBP file/1757745582967.webp', prompt: 'A portrait of a woman in traditional Indian attire and intricate face paint against a colorful wall.' },
                { id: '17', url: 'WEBP file/1757751931474.webp', prompt: 'A woman in a traditional dress with a red flower in her hair, standing against a sunlit, textured wall.' },
                { id: '18', url: 'WEBP file/1757754116818.webp', prompt: 'A massive unfinished statue of a man in a suit, surrounded by scaffolding in the middle of a city intersection.' },
                { id: '19', url: 'WEBP file/1757754828968.webp', prompt: 'A man in a suit interacting with a miniature version of himself standing on a display platform, surrounded by collectibles.' },
                { id: '20', url: 'WEBP file/1757737330483.webp', prompt: 'A joyful man in a traditional costume, dancing with dandiya sticks amidst a lively celebration with falling confetti.' }
                ];

            const showMessage = (text, isError = false) => {
                messageText.textContent = text;
                messageBox.classList.remove('translate-y-20', 'opacity-0');
                messageBox.classList.add('translate-y-0', 'opacity-100');
                messageBox.classList.toggle('bg-red-600', isError);
                messageBox.classList.toggle('bg-blue-600', !isError);
                setTimeout(() => {
                    messageBox.classList.remove('translate-y-0', 'opacity-100');
                    messageBox.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            };

            const generateNewPrompt = async (originalPrompt) => {
                rewriteText.textContent = '';
                rewriteLoader.classList.remove('hidden');
                rewritePromptBtn.disabled = true;

                const userQuery = `Rewrite the following image prompt to be more creative and descriptive: "${originalPrompt}"`;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const newPrompt = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Failed to generate new prompt.";
                    modalPrompt.textContent = newPrompt;
                } catch (error) {
                    console.error("Error generating new prompt:", error);
                    showMessage("Failed to rewrite prompt.", true);
                } finally {
                    rewriteText.textContent = 'Rewrite Prompt âœ¨';
                    rewriteLoader.classList.add('hidden');
                    rewritePromptBtn.disabled = false;
                }
            };

            const generateAudio = async (text) => {
                listenText.textContent = '';
                listenLoader.classList.remove('hidden');
                listenPromptBtn.disabled = true;

                const payload = {
                    contents: [{ parts: [{ text: text }] }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: { prebuiltVoiceConfig: { voiceName: "Puck" } }
                        }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const base64ToArrayBuffer = (base64) => {
                            const binaryString = window.atob(base64);
                            const len = binaryString.length;
                            const bytes = new Uint8Array(len);
                            for (let i = 0; i < len; i++) {
                                bytes[i] = binaryString.charCodeAt(i);
                            }
                            return bytes.buffer;
                        };

                        const pcmToWav = (pcmData, sampleRate) => {
                            const pcm16 = new Int16Array(pcmData);
                            const buffer = new ArrayBuffer(44 + pcm16.length * 2);
                            const view = new DataView(buffer);

                            function writeString(view, offset, string) {
                                for (let i = 0; i < string.length; i++) {
                                    view.setUint8(offset + i, string.charCodeAt(i));
                                }
                            }

                            let offset = 0;
                            writeString(view, offset, 'RIFF'); offset += 4;
                            view.setUint32(offset, 36 + pcm16.length * 2, true); offset += 4;
                            writeString(view, offset, 'WAVE'); offset += 4;
                            writeString(view, offset, 'fmt '); offset += 4;
                            view.setUint32(offset, 16, true); offset += 4;
                            view.setUint16(offset, 1, true); offset += 2;
                            view.setUint16(offset, 1, true); offset += 2;
                            view.setUint32(offset, sampleRate, true); offset += 4;
                            view.setUint32(offset, sampleRate * 2, true); offset += 4;
                            view.setUint16(offset, 2, true); offset += 2;
                            view.setUint16(offset, 16, true); offset += 2;
                            writeString(view, offset, 'data'); offset += 4;
                            view.setUint32(offset, pcm16.length * 2, true); offset += 4;

                            const pcmView = new Uint8Array(buffer, 44);
                            for (let i = 0; i < pcm16.length; i++) {
                                pcmView[i * 2] = pcm16[i] & 0xFF;
                                pcmView[i * 2 + 1] = (pcm16[i] >> 8) & 0xFF;
                            }
                            
                            return new Blob([buffer], { type: 'audio/wav' });
                        };

                        const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                        const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 16000;
                        const pcmData = base64ToArrayBuffer(audioData);
                        const wavBlob = pcmToWav(pcmData, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        const audio = new Audio(audioUrl);
                        audio.play();

                    } else {
                        throw new Error("Invalid audio data received.");
                    }
                } catch (error) {
                    console.error("Error generating audio:", error);
                    showMessage("Failed to generate audio.", true);
                } finally {
                    listenText.textContent = 'Listen to Prompt ðŸŽ§';
                    listenLoader.classList.add('hidden');
                    listenPromptBtn.disabled = false;
                }
            };

            const renderGallery = () => {
                galleryDiv.innerHTML = '';
                galleryItems.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'gallery-card rounded-xl shadow-lg p-2 cursor-pointer';
                    card.innerHTML = `
                        <img src="${item.url}" alt="Gallery Image" class="w-full h-48 object-cover rounded-md mb-2">
                        <p class="text-sm text-gray-400 truncate px-2">${item.prompt}</p>
                    `;
                    card.addEventListener('click', () => showDetails(item));
                    galleryDiv.appendChild(card);
                });
            };

            const showDetails = (item) => {
                modalImage.src = item.url;
                modalPrompt.textContent = item.prompt;
                detailModal.classList.remove('hidden');
                detailModal.classList.add('flex', 'modal-show');
                rewritePromptBtn.onclick = () => generateNewPrompt(modalPrompt.textContent);
                listenPromptBtn.onclick = () => generateAudio(modalPrompt.textContent);
            };

            const closeModal = () => {
                detailModal.classList.add('hidden');
                detailModal.classList.remove('flex', 'modal-show');
            };

            closeModalBtn.addEventListener('click', closeModal);
            window.addEventListener('click', (e) => {
                if (e.target === detailModal) {
                    closeModal();
                }
            });

            // Initial render
            renderGallery();
        });
    </script>
</body>
</html>
